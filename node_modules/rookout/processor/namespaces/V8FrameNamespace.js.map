{"version":3,"sources":["../../../../src/processor/namespaces/V8FrameNamespace.js"],"names":["V8FrameNamespace","Namespace","constructor","debug","frame","position","readAttribute","name","i","scopeCount","valueObject","scope","scopeObject","value","hasOwnProperty","JSObjectNamespace","RookAttributeNotFound","callMethod","args","filename","line","function","locals","dump","getPosition","module","result","depth","parseInt","undefined","Object","keys","dumpConfig","maxDepth","ContainerNamespace","sourceLocation","rawPosition","script","column","func","getScript","id","mapConsumer","originalPosition","getOriginalPosition","source"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nimport Namespace from './Namespace';\r\nimport JSObjectNamespace from './JSObjectNamespace';\r\nimport {RookAttributeNotFound} from \"../../exceptions\";\r\nimport ContainerNamespace from \"./ContainerNamespace\";\r\nimport {logger} from \"../../logger\";\r\nimport {DEFAULT_TRACEBACK_LIMIT} from \"./V8StackNamespace\";\r\n\r\nexport default class V8FrameNamespace extends Namespace {\r\n\r\n    constructor(debug, frame) {\r\n        super();\r\n\r\n        this.debug = debug;\r\n\r\n        this.frame = frame;\r\n        this.position = null;\r\n    }\r\n\r\n    readAttribute(name) {\r\n        for (let i = 0; i < this.frame.scopeCount(); ++i) {\r\n            const valueObject = this.frame.scope(i).scopeObject().value();\r\n            if (valueObject.hasOwnProperty(name)) {\r\n                return new JSObjectNamespace(valueObject[name]);\r\n            }\r\n        }\r\n\r\n        throw new RookAttributeNotFound(name);\r\n    }\r\n\r\n    callMethod(name, args) {\r\n        switch (name) {\r\n            case \"filename\":\r\n            case \"module\":\r\n                return this.filename();\r\n            case \"line\":\r\n                return this.line();\r\n            case \"function\":\r\n            case \"method\":\r\n                return this.function();\r\n            case \"locals\":\r\n                return this.locals(args);\r\n            case \"dump\":\r\n                return this.dump(args);\r\n            default:\r\n                return super.callMethod(name, args);\r\n        }\r\n    }\r\n\r\n    filename() {\r\n        return new JSObjectNamespace(this.getPosition().filename);\r\n    }\r\n\r\n    module() {\r\n        return this.filename();\r\n    }\r\n\r\n    line() {\r\n        return new JSObjectNamespace(this.getPosition().line);\r\n    }\r\n\r\n    function() {\r\n        return new JSObjectNamespace(this.getPosition().function);\r\n    }\r\n\r\n    locals(args) {\r\n        let result = {};\r\n\r\n        let depth = null;\r\n        if (null != args && '' !== args) {\r\n            depth = parseInt(args);\r\n        }\r\n\r\n        // We iterate from the top down to get all scopes in the correct order, skipping the top scope (Global/Injected)\r\n        for (let i = this.frame.scopeCount() - 2; i >= 0; --i) {\r\n            let scope = this.frame.scope(i).scopeObject().value();\r\n\r\n            // Skip global scope\r\n            if (undefined !== scope['__filename']) {\r\n                continue;\r\n            }\r\n\r\n            for (let name of Object.keys(scope)) {\r\n                result[name] = new JSObjectNamespace(scope[name]);\r\n\r\n                if (null != depth) {\r\n                    result[name].dumpConfig.maxDepth = depth\r\n                }\r\n            }\r\n        }\r\n\r\n        return new ContainerNamespace(result);\r\n    }\r\n\r\n    dump(args) {\r\n        return new ContainerNamespace({\r\n            locals: this.locals(args),\r\n            module: this.module(),\r\n            filename: this.filename(),\r\n            line: this.line(),\r\n            function: this.function(),\r\n        })\r\n    }\r\n\r\n    getPosition() {\r\n        if (null !== this.position) {\r\n            return this.position;\r\n        }\r\n\r\n        const sourceLocation = this.frame.sourceLocation();\r\n\r\n        this.rawPosition = {\r\n            filename: sourceLocation.script.name,\r\n            line: sourceLocation.line + 1,\r\n            column: sourceLocation.column,\r\n            function: this.frame.func().name()\r\n        };\r\n\r\n        const script = this.debug.getScript(sourceLocation.script.id);\r\n        if (null !== script && null !== script.mapConsumer) {\r\n\r\n            const originalPosition = script.getOriginalPosition(this.rawPosition.line, this.rawPosition.column);\r\n            if (null != originalPosition) {\r\n                this.position = {\r\n                    filename: originalPosition.source,\r\n                    line: originalPosition.line,\r\n                    column: originalPosition.column,\r\n                    function: this.rawPosition.function,\r\n                };\r\n            }\r\n        }\r\n\r\n        // If we have been unable to get original position, just use raw position\r\n        if (null == this.position) {\r\n            this.position = this.rawPosition;\r\n        }\r\n\r\n        return this.position;\r\n    }\r\n\r\n}\r\n"],"file":"V8FrameNamespace.js"}