{"version":3,"sources":["../../../src/com_ws/TokenBucket.js"],"names":["TokenBucket","constructor","limit","intervalSeconds","doOnceWhenExhausted","_remaining","_initialValue","_lastReset","Date","now","_intervalSeconds","_doOnceWhenExhausted","_doOnceWhenExhaustedPerformed","_isExhausted","doIfAvailable","func"],"mappings":";;;;;;;AAAe,MAAMA,WAAN,CAAkB;AAC7BC,EAAAA,WAAW,CAACC,KAAD,EAAQC,eAAR,EAAyBC,mBAAzB,EAA8C;AACrD,SAAKC,UAAL,GAAkBH,KAAlB;AACA,SAAKI,aAAL,GAAqBJ,KAArB;AACA,SAAKK,UAAL,GAAkBC,IAAI,CAACC,GAAL,EAAlB;AACA,SAAKC,gBAAL,GAAwBP,eAAxB;AACA,SAAKQ,oBAAL,GAA4BP,mBAA5B;AACA,SAAKQ,6BAAL,GAAqC,KAArC;AACH;;AAEDC,EAAAA,YAAY,GAAG;AACX,QAAKL,IAAI,CAACC,GAAL,KAAa,KAAKF,UAAnB,IAAmC,KAAKG,gBAAL,GAAwB,IAA/D,EAAsE;AAClE,WAAKH,UAAL,GAAkBC,IAAI,CAACC,GAAL,EAAlB;AACA,WAAKJ,UAAL,GAAkB,KAAKC,aAAvB;AACA,WAAKM,6BAAL,GAAqC,KAArC;AACH;;AAED,WAAO,KAAKP,UAAL,GAAkB,CAAzB;AACH;;AAEDS,EAAAA,aAAa,CAACC,IAAD,EAAO;AAChB,SAAKV,UAAL,IAAmB,CAAnB;;AACA,QAAI,KAAKQ,YAAL,EAAJ,EAAyB;AACrB,UAAI,KAAKF,oBAAL,IAA6B,KAAKC,6BAAL,KAAuC,KAAxE,EAA+E;AAC3E,aAAKA,6BAAL,GAAqC,IAArC;;AACA,aAAKD,oBAAL;AACH;;AACD;AACH;;AAEDI,IAAAA,IAAI;AACP;;AA/B4B","sourcesContent":["export default class TokenBucket {\n    constructor(limit, intervalSeconds, doOnceWhenExhausted) {\n        this._remaining = limit;\n        this._initialValue = limit;\n        this._lastReset = Date.now();\n        this._intervalSeconds = intervalSeconds;\n        this._doOnceWhenExhausted = doOnceWhenExhausted;\n        this._doOnceWhenExhaustedPerformed = false;\n    }\n\n    _isExhausted() {\n        if ((Date.now() - this._lastReset) >= (this._intervalSeconds * 1000)) {\n            this._lastReset = Date.now();\n            this._remaining = this._initialValue;\n            this._doOnceWhenExhaustedPerformed = false;\n        }\n\n        return this._remaining < 0;\n    }\n\n    doIfAvailable(func) {\n        this._remaining -= 1;\n        if (this._isExhausted()) {\n            if (this._doOnceWhenExhausted && this._doOnceWhenExhaustedPerformed === false) {\n                this._doOnceWhenExhaustedPerformed = true;\n                this._doOnceWhenExhausted();\n            }\n            return;\n        }\n\n        func();\n    }\n}"],"file":"TokenBucket.js"}